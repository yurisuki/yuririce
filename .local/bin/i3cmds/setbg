#!/bin/sh
# This script will set a wallpaper
# on wal, betterlockscreen or both.
# It's used by vifm, but it can be
# also used in terminal.

# Check if programs are presented
command -v betterlockscreen >/dev/null 2>&1 && lockutility="betterlockscreen" || printf "\`betterlockscreen\` is not present\\n" # `betterlockscreen`
command -v wal >/dev/null 2>&1 && wallutility="wal" || printf "\`wal\` is not present.\\n" # `wal`

# Variables:
! [ -d "${XDG_DATA_HOME:-$HOME/.local/share}/setbg" ] && mkdir "${XDG_DATA_HOME:-$HOME/.local/share}/setbg" && wallsdirectory="${XDG_DATA_HOME:-$HOME/.local/share}/setbg" \
	|| wallsdirectory="${XDG_DATA_HOME:-$HOME/.local/share}/setbg" # This one checks if $wallsdirectory exists, if not, then create it.

# Commands:
checkextension() { case "$2" in
	*.png|*.jpg) ;;
	*) printf "I don\'t know this file extension, please use only:\\n.png\\n.jpg\n" && exit 1 ;;
esac ;}
help() { printf "This script will set wallpaper in YARBS, it will set WM background, and lockscreen background.\\n\\nARGUMENTS:\\n--help/-h: shows this help message\\n--all/-a: changes wallpaper for both lockscreen and WM\\n--wall/-w: changes wallpaper for WM\\n--lock/-l: changes wallpaper for lockscreen\\n--refresh/-r: Refresh wallpaper\\n" ;}
all() { $wallutility -i "$2" && cp "$2" "$wallsdirectory/wall.png" && $wallutility -c && cp "$wallsdirectory/wall.png" "$wallsdirectory/walllock.png" && $lockutility -u "$wallsdirectory/walllock.png" ;}
lock() { cp "$2" "$wallsdirectory/walllock.png" && $lockutility -u "$wallsdirectory/walllock.png" ;}
wall() { $wallutility -i "$2" && cp "$2" "$wallsdirectory/wall.png" && $wallutility -c ;}
refresh() { ! [ -f "$wallsdirectory/wall.png" ] && \
	notify-send "$(printf "‚ùå wall.png doesn\'t exist.\\nWon\'t refresh wallpaper.")" && printf "wall.png doesn\'t exist. Won\'t refresh wallpaper.\\n" \
	|| wal -i "$wallsdirectory/wall.png" && betterlockscreen -u "$wallsdirectory/walllock.png" ;}
finished() { notify-send "üñºÔ∏è Background set!" ;}

case "$1" in
	--help|-h) help ;;
	--all|-a) checkextension "$@" && all "$@" && finished ;;
	--wall|-w) checkextension "$@" && wall "$@" && finished ;;
	--lock|-l) checkextension "$@" && lock "$@" && finished ;;
	--refresh|-r) refresh & ;;
	*) help ;;
esac
